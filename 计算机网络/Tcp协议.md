> > > TCP协议是一种面向连接的、可靠的、基于字节流的传输层通信协议
> >
> > #### TCP协议头部格式
> >
> > ![image-20210113195729289](https://sz-note-md.oss-cn-beijing.aliyuncs.com/img/image-20210113195729289.png)
> >
> > ##### 源端口（Source Port）和目标端口（Destination Port）
> >
> > > 分别占用16位，表示源端口号和目的端口号，0 ~ 2^16，用于区别主机中的不同进程，因为0 ~ 1023端口是系统使用，所以源端口和目标端口的适用范围是1024 ~ 65535之间，IP地址由应用层IP协议头部加入，源端口号和目的端口号配合上IP首部中的源IP地址和目的IP地址就能唯一的确定一个TCP连接；
> >
> > ##### Sequence number (seq)
> >
> > > **32位序号 seq**，TCP通信过程中某一个传输方向上的字节流的每个字节的序号，通过这个来确认发送的数据**有序**，比如现在序列号为1000，发送了1000，下一个序列号就是2000。
> >
> > ##### Acknowledge number (ack)
> >
> > > **32位确认号 ack**，TCP对上一次seq序号做出的确认号，用来响应TCP报文段，给收到的TCP报文段的序号seq加1。
> >
> > ##### **TCP的标志位**
> >
> > > ACK：应答域有效，确认	
> > >
> > > SYN：同步序号，用于建立连接；SYN标志和ACK标志同时使用，当连接请求的时候，SYN=1,ACK=0;连接被响应的时候，SYN=1,ACK=1；
> > >
> > > FIN：表示发送端的数据已经到达尾部，数据传输完成，发送了FIN标记为的数据包，连接断开。
> > >
> > > RET：重置连接
> > >
> > > URG：紧急指针有效
> > >
> > > PSH：接收方尽快将数据包交给应用层
> >
> > #### ACK和ack区别
> >
> > - 小写的ack代表的是TCP协议头部的确认号Acknowledge number， 缩写ack，是对上一个包的序号进行确认的号，ack=seq+1。
> > - 大写的ACK，则是我们上面说的TCP首部的标志位，用于标志的TCP包是否对上一个包进行了确认操作，如果确认了，则把ACK标志位设置成1。
> >
> > <img src="https://sz-note-md.oss-cn-beijing.aliyuncs.com/img/TCP三次握手、四次挥手.jpg" alt="TCP三次握手、四次挥手" style="zoom:50%;" />
> >
> > 为什么要三次握手，两次不行吗？      
> > 防止已经失效的请求链接报文传到服务器，发送错误，浪费资源        
> >
> > >eg：client发出请求没有丢失，在某个网络节点周转停留时间过久，以至于延误到服务器关闭后才到达服务器，服务器以为是新的连接请求，然后就确认连接，并且给client端发送确认信息，开始等待client的回应，
> > >而客户端并没有发出请求的报文，于是客户端就不理服务器，服务器一直等待，浪费资源
> >
> > ##### TCP四次挥手
> >
> > - 第一次：主机A发送FIN断开连接标志，确认包给主机B，主机A进入==FIN_WAIT_1==状态
> > - 第二次：主机B接受到FIN报文，进入==CLOSE_WAIT==状态，向主机A回复一个ACK确认包，主机A进==入FIN_WAIT_2==状态
> > - 第三次：主机B向主机A发送到FIN报文，进入==LAST_ACK==状态
> > - 第四次：主机A接受到FIN报文，向B发送ACK包，进入==TIME_WAIT==状态；主机B收到关闭链接信号后断开连接，主机A在2ms后没有收到信息，自动关闭
> >
> > ![四次挥手](https://sz-note-md.oss-cn-beijing.aliyuncs.com/img20210130222408.png)
> >
> > #### 为什么客户端需要在WAIT_TIME保持2MSL？
> >
> > 1.为了确保第四次挥手的确认应答（ack）、ACK标志位 能被服务器接收到   
> > 2.确保所有的老链接都在网络中消失。
> > https://blog.csdn.net/qq_41878620/article/details/105628943
> >
> > 
> >
> > #### TCP协议可靠原理
> >
> > ![](https://sz-note-md.oss-cn-beijing.aliyuncs.com/imgimage-20210120225307566.png)
> >
> > 1. 序列号、确认应答
> >
> > > 只有当一段收到消息并相应给发送端，才算是一个完整的传输过程。确认机制包含 确认丢失 、 确认迟到。因为传输确认给予是基于序列号做标识。**TCP 能够识别是否已经接收数据，又能够判断是否需要接收，从而实现可靠传输**
> >
> > ![image-20210119200724157](https://sz-note-md.oss-cn-beijing.aliyuncs.com/img/image-20210119200724157.png)
> >
> > 2. 超时重传机制
> >
> >    > 如果客户端发送了数据，在一定时间段内都没有收到应答，则会认为数据丢失，并进行 **数据重发**
> >
> >    - 发送端发送丢包
> >    - 接收端确认ack丢包
> >
> > 3. 连接管理
> >
> > > TCP协议面向连接，在数据通信之前会先做好通信两端的准备工作，TCP首部会发送一个SNY信号包作为**建立连接**和**等待确认应答**，在对端发送ACK信号包后建立连接通信，通信完毕会发送FIN包关闭连接，涉及到三次握手和四次挥手过程。建立连接的过程中会有一个MSS换过程（**Max Segment Size**最大分段大小 ,选两者小的一个作为标准）
> >
> > 4. 滑动窗口控制
> >
> > > 因为TCP以segment为单位，传输过程需要应答，一段响应了应答才能进行下一个传输。包的往返时间（RTT，Round Trip Time）越长，通信的性能也就越低，为解决此问题，引入了滑动窗口。**窗口大小：无需等待确认应答ACK 而继续发送数据的最大值**。
> >
> > 滑动窗口特点：
> >
> > - **在整个窗口的确认应答没有到达之前，如果其中部分数据出现丢包，那么发送端仍然要负责重传**。为此，发送端主机需要**设置缓存保留这些待被重传的数据，直到收到他们的确认应答**。
> > - 收到确认应答的情况下，窗口会滑动到确认应答中的序列号的位置。**这样可以顺序地将多个段同时发送提高通信性能。这种机制也别称为滑动窗口控制**
> >
> > 滑动窗口和重发控制：发送端报文丢失，接收端没有收到，返回的序列号就会要求重发，**发送端主机如果 连续 3 次 接收到同一个确认应答包，就会将其对应的数据重发，这种机制比之前提到的“超时重发”更加高效，所以被称之为“高速重发控制”**；反之如果接收端发送了ack为2001，那么前面一段的1~2000就表示已经收到，发送端无需重发
> >
> > ![滑动窗口](https://sz-note-md.oss-cn-beijing.aliyuncs.com/img/滑动窗口.png)
> >
> > 5. 流量控制
> >
> > > 流量控制是作用于接收者的，它是控制发送者的发送速度从而使接收者来得及接收，防止分组丢失的
> >
> > ![流量控制](https://sz-note-md.oss-cn-beijing.aliyuncs.com/img/123.png)
> >
> > 6. 拥塞控制
> >
> > > 防止发送方发的太快，使得网络来不及处理，从而导致网络拥塞
> >
> > - 慢开始
> >  刚开始发送方拥塞窗口cwnd为1，发送窗口（swnd）等于拥塞窗口（cwnd），此时发送只能法用一个数据报文段（cwnd是多少就只能发送几个数据报文段），接收方收到数据报文后给发送方回复一个确认报文段，发送方收到确认报文段后，拥塞窗口值变成2,到达ssthres(slow start threshold，慢开始门限)之前，拥塞窗口会指数增加
> >
> > - 拥塞控制
> > 当拥塞窗口cwnd值等于ssthres时，改用拥塞避免算法，拥塞窗口值改成线性增加，每次+1，而不是指数增加。当发送超时重传时，慢开始门限(ssthres)会变成拥塞窗口(cwnd)的一半，将cwnd重置成1，并重新开始慢开始算法
> >
> >
> > - 快重传、快恢复（后续版本中新增优化）
> > 原因：因为确认报文在网络中丢失，导致发送方没有收到，误以为是网络阻塞，导致cwnd重置成1重新开始慢开始算法。
> > 解决：接收方对 缺失的报文序列 告知发送方，同时接受其他序号的数据报文，发送方连续收到3次重复确认，发送方会立即将缺失报文进行重传，而不是等待超时重传（RTO，Retransmission Time Out 超时重传时间），做到快速重传处理，快速回复就是cwnd和ssthre降到原来的一半，重新开始拥塞算法阶段
> >
> > ![TCP的拥塞控制](https://sz-note-md.oss-cn-beijing.aliyuncs.com/img/a7741d3223791e04828b06cf566a6bf71603441882876.png)
> >
> > [TCP协议可靠原理-确认应答、超时重发、面向连接，滑动窗口](https://mp.weixin.qq.com/s/pkhabqv2salM1MpBTH4D6A)
> >
> > [TCP之 流量控制(滑动窗口）和 拥塞控制（拥塞控制的工作过程）](https://blog.csdn.net/dangzhangjing97/article/details/81008836)
> >
> > #### TCP和UDP区别，应用场景
>
